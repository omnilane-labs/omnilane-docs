# Omnilane Core (NEAR)

Omnilane Core is the master contract that orchestrates operations across all chains. It relies on [Chain Signatures](https://docs.near.org/build/chain-abstraction/chain-signatures) to control each chain by signing transactions or messages (e.g. EIP-712 typed messages) which are broadcasted to each chain.

***As an integrator, you don't strictly need to interact with Omnilane Core directly, but you need to understand how it works to integrate with Omnilane.***

# Settle Order

Trades are initiated by users posting an order to any of the supported sender chains, these orders are observed by liquidity providers, who can decide to fill an order at any point, by settling it on Omnilane Core and providing an offer for the output amount of the order.

To settle and order, a market maker would call the following method in Omnilane Core contract in NEAR Blockchain:

```rust
pub fn settle_order(
        &mut self,
        order: Order,
        witness_signature: String,
        amount_out: OutputAmount,
        request_claim_signature: Option<bool>,
    )
```

- `order`: This is the order “as-is” posted by the user in the sender network, all parameters are defined by the user, and its integrity is verified using hashing as described in the “Order Validation” section.
- `witness_signature`: The signature of the market maker that is making this offer. This signature is generated by signing the `orderId` as an EIP-191 message. The **market maker's identity** is recovered from this signature. The market maker should also have a corresponding `witnessedCumulative` in the order.
- `amount_out`: The amount offered by the market maker to fill the order, should be higher or equal to `min_amount_out`.
- `request_claim_signature`: Wether to request the claim signature in the same transaction.

## Order
Below the structure of the order:

```rust
pub struct Order {
    pub amount_in: InputAmount,
    pub min_amount_out: OutputAmount,
    pub broadcast_fee: OutputAmount,

    pub from_asset: Asset,
    pub to_asset: Asset,

    pub to_address: String,
    pub vendor_id: String,
    pub vendor_fee_bps: u32,
    pub partner_id: String,
    pub witnessed_cumulatives: Vec<Witness>,

    pub request_id: [u8; 32],

    pub from_address: String,
    pub timestamp: u128,

    pub order_id: OrderId,
}

pub struct Asset {
    pub chain_id: u32,
    pub decimals: u32,
    pub contract_address: String,
    pub vault_contract_address: String,
}

pub struct Witness {
    pub market_maker: String,
    pub witness: String,
}
```
